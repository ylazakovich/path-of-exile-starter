name: "Run flyway"
on:
  pull_request:
    paths:
      - ".github/workflows/flyway.yml"
      - "tools/scripts/db/migrations/**"
      - "tools/scripts/db/run_flyway.sh"
  push:
    paths:
      - ".github/workflows/flyway.yml"
      - "tools/scripts/db/migrations/**"
      - "tools/scripts/db/run_flyway.sh"
env:
  COMPOSE_PROJECT_NAME: path-of-exile-starter

jobs:
  check-flyway:
    runs-on: ubuntu-latest
    steps:
      - name: üî®Checkout
        uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6
      - name: üê≥ Check Docker Compose
        uses: ylazakovich/compose-health-check-action@v1
        with:
          compose-files: |
            tools/docker/docker-compose.yml
            tools/docker/docker-compose.override.yml
          services: |
            mariadb
            flyway
          timeout: "60"
