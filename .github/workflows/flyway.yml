name: "Run flyway"
on:
  pull_request:
    paths:
      - ".github/workflows/flyway.yml"
      - "tools/scripts/db/migrations/**"
      - "tools/scripts/db/run_flyway.sh"
  push:
    paths:
      - ".github/workflows/flyway.yml"
      - "tools/scripts/db/migrations/**"
      - "tools/scripts/db/run_flyway.sh"
env:
  COMPOSE_PROJECT_NAME: path-of-exile-starter

jobs:
  check-flyway:
    runs-on: ubuntu-latest
    steps:
      - name: üî®Checkout
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6
      - name: üê≥ Check Docker Compose
        uses: ylazakovich/compose-health-check-action@3066b239890cc1f805462a61768ef132f2cff5a6 # v1
        with:
          compose-files: |
            tools/docker/docker-compose.yml
            tools/docker/docker-compose.override.yml
          services: |
            mariadb
            flyway
          timeout: "60"
